<div class="container">
  <h2><%= current_channel.title %></h2>
  <div class="divider"></div>
  <div class="row valign-wrapper">
    <div class="col s6">
      <h3>Playlists</h3>
    </div>
    <div class="col s6">
      <a class="btn-floating waves-effect waves-light right modal-trigger" href="#modal1"><i class="material-icons">add</i></a>
    </div>
  </div>

  <ul class="collection" id="playlist-list">
    <% current_channel.playlists.rank(:row_order).each do |playlist| %>
      <li class="collection-item" data-update-url="<%= contributor_playlist_path(playlist) %>">
        <h5 class="title"><%= playlist.title %></h5>
        <p>
          <ul class="video-list">
            <% playlist.videos.rank(:row_order).each do |video| %>
              <li data-update-url="<%= contributor_video_path(video) %>">
                <div class="divider"></div>
                <div class="section">
                  <h6><b><%= video.title %></b></h6>
                  <span class="truncate"><%= video.description %></span>
                </div>
              </li>
            <% end %>
            <li>
              <a class="secondary-content left modal-trigger new-video-button" href="#modalV" data-video-url="<%= contributor_playlist_videos_path(playlist) %>"><i class="material-icons">add_circle</i></a>
            </li>
          </ul>
        </p>
        <br>

      </li>
    <% end %>
  </ul>

</div>

<!-- render partials for modals -->
<%= render partial: "contributor/playlists/new" %>
<%= render partial: "contributor/videos/new" %>


<script>
  $(function() {

    $('.video-list').sortable({
      update: function(event, ui) {
        $.ajax({
          type: 'PUT',
          url: ui.item.data('update-url'),
          dataType: 'json',
          data: {
            video: {
              row_order_position: ui.item.index()
            }
          }
        });
      }
    });

    $('#playlist-list').sortable({
      update: function(event, ui) {
        $.ajax({
          type: 'PUT',
          url: ui.item.data('update-url'),
          dataType: 'json',
          data: {
            playlist: {
              row_order_position: ui.item.index()
            }
          }
        });
      }
    });

    $('.new-video-button').click(function(){
      var videoUrl = $(this).data('video-url');
      $('#newVideoForm').attr('action', videoUrl);
    })
  });
</script>
